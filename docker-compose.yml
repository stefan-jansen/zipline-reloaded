services:
  zipline-jupyter:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zipline-reloaded-jupyter
    ports:
      - "${JUPYTER_PORT:-9000}:8888"  # Jupyter Lab (host:container)
    volumes:
      # Mount notebooks directory
      - ./notebooks:/notebooks
      # Mount data directory for persistence
      - ./data:/data
      # Mount zipline data (bundles stored here - persistent across restarts)
      - zipline-data:/root/.zipline
      # Mount scripts directory for management tools
      - ./scripts:/scripts
    environment:
      - ZIPLINE_ROOT=/root/.zipline
      - ZIPLINE_CUSTOM_DATA_DIR=/data/custom_databases
      - PYTHONUNBUFFERED=1
      # API keys from .env file (optional)
      - NASDAQ_DATA_LINK_API_KEY=${NASDAQ_DATA_LINK_API_KEY:-}
      - ALPHA_VANTAGE_API_KEY=${ALPHA_VANTAGE_API_KEY:-}
      - IEX_CLOUD_API_KEY=${IEX_CLOUD_API_KEY:-}
      - POLYGON_API_KEY=${POLYGON_API_KEY:-}
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - zipline-network

volumes:
  zipline-data:
    driver: local

networks:
  zipline-network:
    driver: bridge
